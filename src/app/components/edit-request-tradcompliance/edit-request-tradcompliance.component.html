<h1 mat-dialog-title>Edit Request (Trade Compliance)</h1>
<div mat-dialog-content>
  <form [formGroup]="requestForm">
    <div class="form-grid">
      <mat-form-field appearance="fill">
        <mat-label>Invoice Type</mat-label>
        <input matInput formControlName="invoicesTypes" readonly>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Shipping Point</mat-label>
        <input matInput formControlName="shippingPoint" readonly>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Delivery Address</mat-label>
        <input matInput formControlName="deliveryAddress" readonly>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Incoterm</mat-label>
        <input matInput formControlName="incoterm" readonly>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Mode Of Transport</mat-label>
        <input matInput formControlName="modeOfTransport" readonly>
      </mat-form-field>
      @if (modeOfTransport() === 'By Air') {
        <mat-form-field appearance="fill">
          <mat-label>DHL Account</mat-label>
          <input matInput formControlName="dhlAccount" readonly>
        </mat-form-field>
      }
      <!-- <mat-form-field appearance="fill">
        <mat-label>HTS Code</mat-label>
        <input matInput formControlName="htsCode" required>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>COO</mat-label>
        <input matInput formControlName="coo" required>
      </mat-form-field> -->
    </div>
    
    <!-- <div formArrayName="items">
      <div *ngFor="let item of items.controls; let i = index" [formGroupName]="i" class="item-form">
        <mat-form-field appearance="fill">
          <mat-label>PN</mat-label>
          <input matInput formControlName="pn" readonly>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Quantity</mat-label>
          <input matInput formControlName="quantity" type="number" readonly>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Unit Of Quantity</mat-label>
          <input matInput formControlName="unitOfQuantity" readonly>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Unit Value Finance</mat-label>
          <input matInput formControlName="unitValueFinance" type="number" readonly>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Description</mat-label>
          <input matInput formControlName="description" readonly>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Cost Center</mat-label>
          <input matInput formControlName="costCenter" readonly>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Business Unit</mat-label>
          <input matInput formControlName="businessUnit" readonly>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>Plant</mat-label>
          <input matInput formControlName="plant" readonly>
        </mat-form-field>
      </div>
    </div> -->


    @if (items.controls.length !== 0) {
      <div class="border border-gray-200 rounded-md overflow-hidden">
        <div class="bg-orange-200 p-2 mb-2 text-center">
          <span class="font-mono text-md w-fit text-orange-600">
            Items
            <span class="font-bold text-xs text-gray-800">
              ({{ items.length }})
            </span>
          </span>
        </div>
        <div class="p-2" formArrayName="items">
          @for (itemGroup of items.controls; track itemGroup; let i = $index) {
            <div [formGroupName]="i" class="mb-4 p-2 border border-gray-300 rounded">
              <div class="flex items-center justify-between mb-2">
                <span class="font-bold">Item {{ i + 1 }}</span>
                <!-- <button mat-icon-button color="warn" matTooltipPosition="above" matTooltip="Remove this item" (click)="removeItem(i)" type="button">
                  <mat-icon>remove_circle</mat-icon>
                </button> -->
              </div>
              <div class="flex items-center gap-2 flex-wrap">
                @for (field of formItems() || []; track field) {
                  <div [formGroupName]="field.nameItem">
                    <mat-form-field appearance="fill" class="w-full mb-2">
                      <mat-label>{{ field.nameItem }}</mat-label>
                      <input 
                        matInput 
                        formControlName="value"
                        [type]="field.type"
                        [readonly]="field.readOnly"
                        [required]="field.isMandatory ?? false"
                      >
                    </mat-form-field>
                  </div>
                }
              </div>
            </div>
          }
        </div>
        <div class="p-2">
          <!-- <button mat-icon-button color="primary" matTooltipPosition="above" matTooltip="Add another item" (click)="addItem()" type="button">
            <mat-icon>add_circle</mat-icon>
          </button> -->
          <!-- <button mat-raised-button color="primary" matTooltip="" (click)="addItem()" type="button">
            <mat-icon>add_circle</mat-icon>
          </button> -->
        </div>
      </div>
    }


    <div mat-dialog-actions>
      <button mat-raised-button color="warn" type="button" (click)="openRejectDialog()">Reject</button>
      <button mat-raised-button color="primary" type="button" (click)="onSubmit()" [disabled]="!requestForm.valid">Submit</button>
    </div>
  </form>
</div>
