<div class="flex items-center justify-between p-4">
  <span class="text-xl font-semibold">
    Edit Request
    <span class="text-gray-500 text-sm">(Warehouse)</span> [<span
      class="text-cyan-600 font-semibold font-serif"
      >{{ data.requestNumber }}</span
    >]
  </span>

  @if (requestSig()?.status; as status) {
  <app-request-status [status]="status" />
  }
</div>

<div class="form-container">
  <form [formGroup]="requestForm" (ngSubmit)="onSubmit()">
    <div class="form-grid">
      <mat-form-field appearance="fill" class="small-form-field">
        <mat-label>Invoice Type</mat-label>
        <input matInput formControlName="invoicesTypes" readonly />
      </mat-form-field>

      <mat-form-field appearance="fill" class="small-form-field">
        <mat-label>Shipping Point</mat-label>
        <input matInput formControlName="shippingPoint" readonly />
      </mat-form-field>

      <mat-form-field appearance="fill" class="small-form-field">
        <mat-label>Delivery Address</mat-label>
        <input matInput formControlName="deliveryAddress" readonly />
      </mat-form-field>

      <mat-form-field appearance="fill" class="small-form-field">
        <mat-label>Incoterm</mat-label>
        <input matInput formControlName="incoterm" readonly />
      </mat-form-field>

      <mat-form-field appearance="fill" class="small-form-field">
        <mat-label>Mode Of Transport</mat-label>
        <input matInput formControlName="modeOfTransport" type="text" />
      </mat-form-field>

      @if (modeOfTransport() === 'By Air') {
      <mat-form-field appearance="fill">
        <mat-label>DHL Account</mat-label>
        <input matInput formControlName="dhlAccount" readonly />
      </mat-form-field>
      }

      <mat-form-field>
        <mat-label>Currency</mat-label>
        <mat-select formControlName="currency" name="currency">
          @for (option of currencyCodes(); track option) {
          <mat-option [value]="option">{{ option }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill" class="small-form-field">
        <mat-label>Shipped Via</mat-label>
        <input matInput formControlName="shippedVia" type="text" />
      </mat-form-field>

      <mat-form-field appearance="fill" class="small-form-field">
        <mat-label>Gross Weight</mat-label>
        <input matInput formControlName="grossWeight" type="number" min="0" />
      </mat-form-field>

      @if (showTrackingNoField()) {
      <mat-form-field appearance="fill" class="small-form-field">
        <mat-label>Tracking Number</mat-label>
        <input matInput required formControlName="trackingNumber" type="text" />
      </mat-form-field>
      }

      <mat-form-field appearance="fill">
        <mat-label>Volume</mat-label>
        <input matInput formControlName="dimension" />
      </mat-form-field>

      <app-parcels />
    </div>

    <!-- Items Array -->
    @if (items.controls.length !== 0) {
    <div class="border border-gray-200 rounded-md overflow-hidden">
      <div class="bg-orange-200 p-2 mb-2 text-center">
        <span class="font-mono text-md w-fit text-orange-600">
          Items
          <span class="font-bold text-xs text-gray-800">
            ({{ items.length }})
          </span>
        </span>
      </div>
      @defer {
      <div class="p-2" formArrayName="items">
        @for (itemGroup of items.controls; track itemGroup; let i = $index) {
        <div
          [formGroupName]="i"
          class="mb-4 p-2 border border-gray-300 rounded shadow-md"
        >
          <div class="flex items-center justify-between mb-2">
            <span class="font-bold">Item {{ i + 1 }}</span>
          </div>
          <div class="flex items-center gap-2 flex-wrap">
            @for (field of formItems() || []; track field) {
            <div [formGroupName]="field.nameItem">
              <mat-form-field appearance="fill" class="w-full mb-2">
                <mat-label>{{ field.nameItem }}</mat-label>
                <input
                  matInput
                  formControlName="value"
                  [type]="field.type"
                  [required]="field.isMandatory"
                  [readonly]="field.readOnly"
                />
              </mat-form-field>
            </div>
            }
          </div>
        </div>
        }
      </div>
      } @placeholder (minimum 700ms) {
      <loading-dots [diameter]="25" />
      }
    </div>
    }

    <div class="form-actions" mat-dialog-actions>
      <button mat-raised-button type="submit" [disabled]="!requestForm.valid">
        Submit
      </button>
    </div>
  </form>
</div>
